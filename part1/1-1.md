服务注册阶段主要分为两个过程，一是Server启动，二是服务发布。

# Server启动

通过Spring Schema配置或者通过@Service注解的形式配置Pigeon的Provider服务，启动服务时都会首先初始化ServiceBean并调用其init\(\)方法进行服务注册。ServiceBean中的配置属性值通过Spring Schema或@Service注解进行设置。

```java
public void init() throws Exception {
    ServerConfig serverConfig = new ServerConfig();
    serverConfig.setPort(port);
    serverConfig.setAutoSelectPort(autoSelectPort);
    serverConfig.setCorePoolSize(corePoolSize);
    serverConfig.setMaxPoolSize(maxPoolSize);
    serverConfig.setWorkQueueSize(workQueueSize);
    serverConfig.setEnableTest(enableTest);
    List<ProviderConfig<?>> providerConfigList = new ArrayList<ProviderConfig<?>>();
    for (String url : services.keySet()) {
        ProviderConfig<Object> providerConfig = new ProviderConfig<Object>(services.get(url));
        providerConfig.setUrl(url);
        providerConfig.setServerConfig(serverConfig);
        providerConfig.setCancelTimeout(cancelTimeout);
        providerConfigList.add(providerConfig);
    }
    ServiceFactory.addServices(providerConfigList);
}
```





